<f3:inject id="content">
    <h2 class="text-lg font-bold">{{ t('menu.post') }}</h2>
    <div x-data="FFTable(post)">
        <include href="blocks/table.html" />
        <include href="blocks/modal-form.html" with="modal_content=post/form.html" />
    </div>
</f3:inject>
<f3:inject id="script">
    <script src="{{@BASE}}/js/fftable.min.js"></script>
    <script type="text/javascript">
        let post = {
            fields: [
                { title: 'ID', name: 'id', visible: false },
                { title: '{{ t("content.post.title") }}', name: 'title', searchable: true },
                { title: '{{ t("content.post.slug") }}', name: 'slug', searchable: true },
                { title: '{{ t("content.post.keyword") }}', name: 'keyword', searchable: true },
                { title: '{{ t("content.post.category") }}', name: 'category', type: 'select', options: JSON.parse(`{{\Util\Content::categoryOption()}}`) },
                { title: '{{ t("content.post.summary") }}', name: 'summary', class: 'min-w-40', searchable: true },
                { title: '{{ t("content.post.content") }}', name: 'content', sortable: false, visible: false },
                { title: '{{ t("content.post.published") }}', name: 'published', class: 'whitespace-nowrap', type: 'datetime-local', formatter: v => v ? dayjs(v).format('D MMM YYYY') : '' },
            ],

            // table options
            table: {
                url: '{{@BASE}}/ajax/content/posts',
                editable: true,
                addable: true,
                editable: true,
                deletable: true,
                selection: 'single',
                pageSize: 20,
                sorting: 'multiple',
                sort: [{ col: 'created', sort: 'desc' }],
                toolbar: [{
                    title: 'View',
                    action(data) { location.href = '{{@BASE}}/post/' + data.slug },
                    show(selection) { return selection },
                    icon: '<svg class="h-full" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>'
                }],
                functions: {
                    add() { location.href = '{{@BASE}}/post/edit'; return true },
                    edit(data) { location.href = '{{@BASE}}/post/edit?id=' + data.id; return true }
                }
            },

            // form options
            form: {
                url: '{{@BASE}}/ajax/content/post-edit',
                object: 'Post',
                size: 'huge', // small, normal, large, huge 
                columns: 1,
                pk: ['id'], // primary key
                fullHeight: true,
                formInit(data) {
                    initTinymce('#content');
                    return data;
                },
                onShow(data) {
                    tinymce.get('content').setContent(data['content']);
                    return data;
                },
                preSubmit(data) {
                    data['content'] = tinymce.get('content').getContent();
                    return data;
                }

            }
        }
    </script>
</f3:inject>
<include href="blocks/modal-image-browser.html" />
<include href="blocks/tinymce.html" />
<include href="blocks/popup.html" />