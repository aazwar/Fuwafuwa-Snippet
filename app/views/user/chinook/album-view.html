<f3:inject id="content">
    <div class="max-w-screen-lg p-6 bg-white border border-gray-200 rounded-lg shadow-md dark:bg-gray-800 dark:border-gray-700"
        x-data="album">
        <svg viewBox="0 0 24 24" class="mb-2 stroke-1 size-10 stroke-gray-500 dark:stroke-gray-400 fill-transparent">
            <circle cx="12" cy="12" r="10"></circle>
            <circle cx="12" cy="12" r="3"></circle>
        </svg>
        <h2 class="mb-2 text-2xl font-semibold tracking-tight text-gray-900 dark:text-white">Album</h2>
        <div class="font-normal text-gray-500 dark:text-gray-400">
            <div class="grid md:grid-cols-2">
                <div class="mb-2 text-gray-700 dark:text-gray-200">
                    <div class="text-xs font-bold">Title</div>
                    <div x-text="record.Title">title</div>
                </div>
                <div class="mb-2 text-gray-700 dark:text-gray-200">
                    <div class="text-xs font-bold">Artist</div>
                    <div x-html="record.ArtistName">artist</div>
                </div>

            </div>
        </div>
    </div>
    <div x-data="track">
        <include href="blocks/table.html" />
        <include href="blocks/modal-form.html" />
    </div>
</f3:inject>
<f3:inject id="script">
    <script src="{{@BASE}}/js/fftable.min.js"></script>
    <script>
        const album = {
            record: { Title: '', ArtistName: '' },
            init() {
                let id = '{{@AlbumId}}';
                if (id) {
                    fetchData('{{@BASE}}/ajax/chinook/album/load', { AlbumId: id }).then(data => {
                        data.ArtistName = `<a href="{{@BASE}}/chinook/artist/${data.ArtistId}" class="underline">${data.ArtistName}</a>`;
                        this.record = data
                    });
                }
            }
        }

        const track = FFTable({
            fields: [
                { title: 'TrackId', name: 'TrackId', visible: false },
                {
                    title: 'Track', name: 'Name', raw: true, formatter(v, c, d) {
                        return `<a href="{{@BASE}}/chinook/track/${d.TrackId}" class="underline">${v}</a>`;
                    }
                },
                { title: 'GenreId', name: 'GenreId', visible: false },
                {
                    title: 'Genre', name: 'GenreName', raw: true, formatter(v, c, d) {
                        return `<a href="{{@BASE}}/chinook/genre/${d.GenreId}" class="underline">${v}</a>`;
                    }
                },
                { title: 'Composer', name: 'Composer' },
                { title: 'Price', name: 'UnitPrice', formatter(v) { return '$' + v }, class: 'text-right' },
            ],

            // table options
            table: {
                url: '{{@BASE}}/ajax/chinook/track/elist',
                showToolbar: false,
                selection: 'single',
                pageSize: 20,
                sorting: 'multiple',
                display: 'compact',
                displayClass: 'h-[40vh]',
                size: 'large',
                limit: [{ col: 't.AlbumId', op: '=', value: '{{@AlbumId}}' }],
            },

            form: {
                object: 'Album',
                pk: ['AlbumId']
            }

        });
    </script>
</f3:inject>
<include href="blocks/popup.html" />