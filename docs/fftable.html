<html>
<header>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="default.min.css">
    <link rel="stylesheet" href="tailwind.min.css">
</header>

<body class="container w-full mx-auto dark:bg-gray-900">
    <script src=" toc.js">
    </script>
    <article class="format dark:format-invert w-[90vw] max-w-screen-md lg:w-full relative bg-white dark:bg-gray-900">
        <section id="fftable">
            <h1>FFTable <span
                    class="bg-green-100 text-green-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded dark:bg-green-200 dark:text-green-900">Flagship</span>
            </h1>
            <p>FFTable is the best feature of Fuwafuwa Framework. This feature allows you to quickly build nice,
                responsive
                table view of selected fields in a table. It provides multiple fields sorting, searching, formatting,
                pagination, add/modify record. Let's review Customer view in Chinook sample aplication.</p>
            <img src="images/fuwafuwa-customer-table.webp">
            <pre>
<code>&lt?php
// MODEL: app/controllers/user/model/chinook/customer.php
namespace Model\Chinook;

class Customer extends \Fuwafuwa\BaseModel {

    function __construct(\Data\Chinook $db) {
        parent::__construct($db, 'Customer', ['ai_field' => 'CustomerId',]);
        $this->validation = [
            'rules' => [
                'FirstName' => 'required',
                'LastName' => 'required',
                'Address' => 'required',
                'Email' => 'required|email',
            ]
        ];                    
    }
}</code>
    </pre>
            <pre class="not-format">
<code>&lt;?php
// CONTROLLER: app/controllers/user/ajax/chinook/employee.php

namespace Ajax\Chinook;

class Employee extends \Fuwafuwa\Controller\FFTable {

    function list($f3) {
        $this->record_list('\Model\Chinook\Employee');
    }

    function edit($f3) {
        $this->ajaxEdit('\Model\Chinook\Employee');
    }

    function elist($f3) {
        $sql = "SELECT e.*, h.FirstName as HeadFirstName, h.LastName as HeadLastName
        FROM Employee e
        LEFT JOIN Employee h ON e.ReportsTo = h.EmployeeId ";
        $csql = "SELECT COUNT(1) FROM Employee e";
        $this->record_elist($sql, $csql);
    }
}</code></pre>
            <p>For simple table without lookup from other table, the controller code become very simple, only
                <code>edit</code> and <code>list</code> method is required. The complexity of pagination, searching,
                sorting are
                handled by FFTable.
            </p>
            <pre class="not-format">
<code>&lt;f3:inject id="content">
    &lt;h2 class="text-lg font-bold">Customer&lt;/h2>
    &lt;div x-data="data">
    &lt;include href="blocks/table.html" />
    &lt;include href="blocks/modal-form.html" />
    &lt;/div>
&lt;/f3:inject>
&lt;f3:inject id="script">
    &lt;script src="{{@BASE}}/js-src/fftable.js">&lt;/script>
    &lt;script type="text/javascript">
    let settings = {
        fields: [
        {
            title: 'Customer Id', name: 'CustomerId', visible: false, readonly: true
        },
        {
            title: 'Support Rep', name: 'SupportRepId', visible: false, type: 'select', triggerChange(d) {
            fetchData('{{@BASE}}/ajax/chinook/employee/select-option',).then(data => {
                this.options = data;
            });
            },
        },
        {
            title: 'Last Name', name: 'LastName', formatter(v, c, d) {
            return `&lt;svg viewBox="0 0 24 24" class="inline mr-2 stroke-1 size-4 stroke-gray-500 dark:stroke-gray-400 fill-transparent">
        &lt;use href="#people" />
    &lt;/svg> &lt;a class="underline" href="{{@BASE}}/chinook/customer/${d.CustomerId}">${v}&lt;/a>`;
            }, raw: true, class: 'whitespace-nowrap', searchable: true
        },
        { title: 'First Name', name: 'FirstName', searchable: true },
        { title: 'Company', name: 'Company', class: 'whitespace-nowrap' },
        { title: 'Address', name: 'Address', visible: false, type: 'textarea', fclass: 'md:col-span-2' },
        { title: 'City', name: 'City', class: 'whitespace-nowrap' },
        { title: 'State', name: 'State', visible: false, },
        { title: 'Country', name: 'Country', visible: false, },
        { title: 'PostalCode', name: 'PostalCode', visible: false, },
        { title: 'Phone', name: 'Phone', visible: false, type: 'tel' },
        { title: 'Fax', name: 'Fax', visible: false, type: 'tel' },
        { title: 'Email', name: 'Email', visible: false, type: 'email' },
        ],

        // table options
        table: {
            url: '{{@BASE}}/ajax/chinook/customer/list',
            editable: true,
            selection: 'single',
            pageSize: 20,
            sorting: 'multiple'
            size: 'large',
            // display: 'compact',
        },

        // form options
        form: {
            url: '{{@BASE}}/ajax/chinook/customer/edit',
            object: 'Customer',
            size: 'normal', // small, normal, large, huge
            columns: 2,
            size: 'large',
            pk: ['CustomerId'], // primary key
        }
    }
    let data = FFTable(settings);
    &lt;/script>
&lt;/f3:inject>
&lt;include href="blocks/popup.html" /></code></pre>
            <p>in the content section, we simply include table and modal-form blocks. The detail is in the script
                section, where
                the
                table configuration is defined. Table configuration consists of <code>fields</code>, <code>table</code>
                and
                <code>form</code> property. Available properties for each are below:
            </p>
            <h3>Fields</h3>
            <p>Fields define columns that we want to show in table and form.</p>
            <div class="grid grid-cols-5 even:[&>*]:col-span-4 w-full gap-1">
                <div><code>title</code></div>
                <div>Field title in table column and form</div>
                <div><code>name</code></div>
                <div>Field name in table</div>
                <div><code>visible</code></div>
                <div>If set false, will not show in table</div>
                <div><code>virtual</code></div>
                <div>If set true, will not show in form</div>
                <div><code>readonly</code></div>
                <div>If set true, uneditable in form</div>
                <div><code>hidden</code></div>
                <div>Hidden in form and table, but still submit value</div>
                <div><code>sortable</code></div>
                <div>Boolean, show sorting icons at column header</div>
                <div><code>inline</code></div>
                <div>Show title and input side by side</div>
                <div><code>type</code></div>
                <div>html input type in form (text, date, month, email, etc). Additional types: uploader, checkboxes.
                    Uploader type needs to initiate uploader method. Checkboxes type needs to define encoder, decoder,
                    and default to [], as array will be used as basic operation.
                </div>
                <div><code>default</code></div>
                <div>Default value on create new object</div>
                <div><code>attr</code></div>
                <div>array of attribute to apply to input element (including Alpine JS attributes). Example:
                    <pre>{ 'x-on:keyup.debounce': 'check_input()', 'maxlength': 100 }</pre>
                </div>
                <div><code>validator</code></div>
                <div>function(value, column, data) to validate current value. Return true or error message.</div>
                <div><code>formatter</code></div>
                <div><code>function(value, column, data)</code> to format current value. Example:
                    <pre class="not-format"><code>function(v) { return '$' + v }</code></pre> will add dollar prefix to
                    the value.
                </div>
                <div><code>encoder</code></div>
                <div><code>function(value, column, data)</code> to format data before saving into database:
                    <pre class="not-format"><code>function(v) { return JSON.stringify(v) }</code></pre> will convert
                    data into JSON string.
                </div>
                <div><code>decoder</code></div>
                <div><code>function(value, column, data)</code> to parse data from database
                    <pre class="not-format"><code>function(v) { return JSON.parse(v) }</code></pre> will parse JSON
                    string into array.
                </div>
                <div><code>raw</code></div>
                <div>display as html code or let browser display like ordinary html code</div>
                <div><code>initOptions</code></div>
                <div><code>function(data)</code> to be executed in form show event. Usually for initialization of select
                    options.
                </div>
                <div><code>triggerChange</code></div>
                <div><code>function(data)</code> to be executed when there is a change on watched properties.
                    Example:
                    <pre class="not-format"><code>{ title: 'Support Rep', name: 'SupportRepId', visible: false, type: 'select', triggerChange(d) {
        fetchData('{{@BASE}}/ajax/chinook/employee/select-option',).then(data => {
                this.options = data;
            });
        },
    },
</code></pre>parameter <code>d</code> contains current data. In code above, after executing fetchData, it will set
                    options
                    property of <code>this</code> (current field).
                </div>
                <div><code>watch</code></div>
                <div>array of column change to watch</div>
                <div><code>searchable</code></div>
                <div>field is searchable from search bar</div>
                <div><code>class</code></div>
                <div>css class for table column</div>
                <div><code>fclass</code></div>
                <div>css class for form field</div>
                <div><code>queryPrefix</code></div>
                <div>If you join two or more tables as controller, this prefix + field name will be put in search and
                    order by
                    clause. For example in the controller you query <code>
            SELECT a.timestamp, u.name FROM activity a JOIN user u on
            a.userid = u.userid
          </code>, then you specify a or u for the queryPrefix, depends on which table you intend to query.
                </div>
                <div><code>lookupUrl</code></div>
                <div>Lookup url for Tom Select if using remote source</div>
                <div><code>lookupLabel</code></div>
                <div>Field name of display value. For example we use <code>IdUser</code> and <code>Username</code> pair
                    to represent user in join query, then lookupLabel is assigned with <code>Username</code>.</div>
                <div><code>staticLookup</code></div>
                <div>if set to true, lookup is only performed once, and query is ignored. Usefull if there are
                    considerable amount of select options, and we don't want to put in the code. Use dynamic lookup if
                    there are so many options and it'd better to search with query.</div>
                <div><code>filter</code></div>
                <div>
                    <pre>{ op: 'LIKE',  }</pre> Add filter above table. Op is query operator. If op is
                    <code>BETWEEN</code>, second input filter will be shown.<br>
                    Valid op: LIKE, CONTAINS, START(S), END(S), IS (NOT) NULL, IN, &lt; &lt;= &gt; &gt;= = &lt;&gt;
                    !=<br>
                    For IN filter, value will be split on pipe character. Example:
                    <code>{ op: 'IN', value: 'Black|Green|Red' }</code> will result query <code>
                        field IN ('Black', 'Green',
                        'Red')
                    </code>.<br>
                    For &lt; &lt;= &gt; &gt;= filter, if value2 is specified, opposite sign complement will be added.
                    Example:
                    <code>{ op: '&gt;', value: 10, value2: 20 }</code> will result query <code>
                        (field &gt; 10 AND field &lt;
                        20)
                    </code>
                </div>
            </div>
            <h3>Table</h3>
            <p>table section define table display parameter.</p>
            <div class="grid grid-cols-5 even:[&>*]:col-span-4 w-full gap-1">
                <div><code>url</code></div>
                <div>url to table query controller</div>
                <div><code>addable</code></div>
                <div>Show add button in toolbar</div>
                <div><code>editable</code></div>
                <div>Show edit button in toolbar</div>
                <div><code>deletable</code></div>
                <div>Show delete button in toolbar</div>
                <div><code>printable</code></div>
                <div>Show print button in toolbar</div>
                <div><code>exportable</code></div>
                <div>Show export button in toolbar</div>
                <div><code>searchable</code></div>
                <div>If searchable, show search bar</div>
                <div><code>selection</code></div>
                <div>none, single, multiple</div>
                <div><code>sorting</code></div>
                <div>none, single, multiple</div>
                <div><code>pageSize</code></div>
                <div>Number of record to display per page</div>
                <div><code>display</code></div>
                <div>normal, compact</div>
                <div><code>displayClass</code></div>
                <div>additional class for table</div>
                <div><code>rowClass</code></div>
                <div>additional class for row. A string or function <code>rowClass(idx, row)</code></div>
                <div><code>cellClass</code></div>
                <div>additional class for cell. A string or function <code>cellClass(ridx, cidx, row, col)</code></div>
                <div><code>size</code></div>
                <div>small, normal, large. On mobile, all sizes are the same.</div>
                <div><code>deferLoading</code></div>
                <div>Don't fetch data after initialization.</div>
                <div><code>customHeader</code></div>
                <div>Define complex table header. Example:
                    <pre>
[
    [
        { title: 'City', attr: { rowspan: 2 }, class: 'border-r border-t' },
        { title: 'Clothes', attr: { colspan: 3 }, class: 'border-r border-t' },
        { title: 'Accessories', attr: { colspan: 2 }, class: 'border-t' }
    ],
    [
        { title: 'Trousers', class: 'border-r' },
        { title: 'Skirts', class: 'border-r' },
        { title: 'Dresses', class: 'border-r' },
        { title: 'Bracelets', class: 'border-r' },
        { title: 'Rings' },
    ]
],
                    </pre>
                </div>
                <div><code>footerData</code></div>
                <div>Create sticky footer at the bottom. Example:
                    <pre>
[
    [
        { value: 'Total' },
        { name: 'sum-trousers', value: 10, class: 'text-right' },
        { name: 'sum-skirts', value: 10, class(v) { return { 'text-right': true, 'italic': v < 1000 } }, formatter(v) { return v + 5 } },
        { name: 'sum-dresses', value: 10, class: 'text-right' },
        { name: 'sum-bracelets', value: 10, class: 'text-right' },
        { name: 'sum-rings', value: 10, class: 'text-right' },
    ],
    [
        { value: '%' },
        { name: 'total-trousers', value: 10, class: 'text-right' },
        { name: 'total-skirts', value: 10, class: 'text-right', formatter(v) { return v + 5 } },
        { name: 'total-dresses', value: 10, class: 'text-right' },
        { name: 'total-bracelets', value: 10, class: 'text-right' },
        { name: 'total-rings', value: 10, class: 'text-right' },
    ],
],                        
                    </pre>
                </div>
                <div><code>functions</code></div>
                <div>Array of functions that will override default button function. Example:
                    <pre>functions: {
  add() { location.href = '{{@BASE}}/page/edit'; return true },
  edit(data) { location.href = '{{@BASE}}/page/edit?id=' + data.id; return true; },
}</pre>
                    Each function needs to return true.
                </div>
                <div><code>eventHandler</code></div>
                <div><code>function(event, data)</code></div>
                <div><code>filter</code></div>
                <div>Filter configuration
                    <pre>filter: {
    cols: 1,
    width: 'xl:w-2/3',
}</pre>
                </div>
                <div><code>Toolbar</code></div>
                <div>Additional toolbar button
                    <pre>toolbar: [
  {
    title: 'Filter',
    show(selected, data) { return selected },
    action(data) { submit(data) },
    icon: '&lt;svg&gt;&lt;/svg&gt;'
  }
]</pre>
                    <div><code>tableInit()</code></div>
                    <div>tableInit event, run once to set up table</div>
                </div>
            </div>
            <h3>Form</h3>
            <p>form section define form display parameter.</p>
            <div class="grid grid-cols-5 even:[&>*]:col-span-4 w-full gap-1">
                <div><code>url</code></div>
                <div>url to form controller</div>
                <div><code>object</code></div>
                <div>Title to display in form</div>
                <div><code>size</code></div>
                <div>small, normal, large, huge. On mobile, all sizes are the same.</div>
                <div><code>columns</code></div>
                <div>Number of columns in form. On mobile, only 1 column.</div>
                <div><code>pk</code></div>
                <div>array of primary key</div>
                <div><code>fullHeight</code></div>
                <div>if true, the content container will be full height and having vertical scrollbar. If not, the
                    content container will fit the content.</div>
                <div><code>formInit()</code></div>
                <div>formInit event, run once to set up form</div>
                <div><code>preSubmit</code></div>
                <div><code>function(data, oper)</code> before submit, modify and return the data back</div>
                <div><code>onSubmitted</code></div>
                <div><code>function(data, oper)</code> after submission, modify data before display</div>
                <div><code>onShow</code></div>
                <div><code>function(data)</code> modify data before showing form and return the data back</div>
                <div><code>onSubmitted</code></div>
                <div><code>function(data)</code> modify data after received response from server after submission, and
                    return it</div>
            </div>

            <h3>Backend</h3>
            <p>Ajax backend for table is very simple. You only need to implement <code>list</code> and
                <code>edit</code>. Example:
            <pre class="not-format">
<code>&lt;?php

namespace Ajax;

class User extends \Fuwafuwa\Controller\FFTable {

    function list(\Base $f3): void {
        $this->record_list('\Model\User');
    }

    function edit(\Base $f3): void {
        $this->ajaxEdit('\Model\User');
    }

    function elist($f3) {
        $sql = "SELECT al.*, ar.Name as ArtistName FROM Album al
            JOIN Artist ar ON al.ArtistId = ar.ArtistId";
        $csql = "SELECT COUNT(1) FROM Album al";
        $this->record_elist($sql, $csql);
    }
}</code></pre>
            For list that involves complex query join, we can use <code>elist</code> method. In this method, we pass two
            query, one for listing, and the other for counting.
            </p>
            <h3>Generators</h3>
            <p>Generators also available for FFTable to get basic form of the MVC files and modify later. Run this
                command in
                CLI:</p>
            <pre>
<code class="languange-bash">php index.php data/generator/model --table=Customer > app/controllers/user/model/customer.php
php index.php data/generator/fftable --table=Customer > app/views/user/customers.html
php index.php data/generator/ajax-fftable --table=Customer > app/controllers/user/ajax/table/customer.php</code></pre>
            <p>See demo <a href="../../chinook/demo">here</a></p>
        </section>
    </article>
    <nav class="flex py-4">
        <a href="building.html">
            <button type="button"
                class="text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700">Prev</button>
        </a>
        <a href="simple-table.html">
            <button type="button"
                class="text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700">Next</button>
        </a>
    </nav>
    <script src="highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>

</html>